@model List<CMCSPart2.Models.Claim>

<h2>Claims</h2>

<style>    table.table-fixed {
        table-layout: fixed;
        width: 100%;
    }

        table.table-fixed th, table.table-fixed td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
        }
    td.col-notes {
        white-space: normal;
    }
    td.col-docs a {
        max-width: 100%;
        display: inline-block;
    }
</style>

<table class="table table-striped table-hover table-fixed">
    <thead class="table-dark">
        <tr>
            <th style="width:80px;">Claim ID</th>
            <th style="width:140px;">Lecturer Name</th>
            <th style="width:110px;">Lecturer ID</th>
            <th style="width:90px;">Hours</th>
            <th style="width:100px;">Rate</th>
            <th style="width:110px;">Total</th>
            <th style="width:120px;">Status</th>
            <th style="width:150px;">Submitted</th>
            <th style="width:180px;">Last Decision By</th>
            <th>Notes</th>
            <th style="width:240px;">Documents</th>
            <th style="width:240px;">Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var claim in Model)
        {
            var latest = (claim.Approvals != null && claim.Approvals.Any()) ? claim.Approvals.First() : null;
            <tr>
                <td>@claim.ClaimId</td>
                <td>@(string.IsNullOrWhiteSpace(claim.LecturerUsername) ? "—" : claim.LecturerUsername)</td>
                <td>@claim.LecturerId</td>
                <td>@claim.HoursWorked</td>
                <td>@claim.HourlyRate.ToString("C")</td>
                <td>@claim.TotalAmount.ToString("C")</td>
                <td>@claim.Status</td>
                <td>@claim.SubmittedAt.ToString("yyyy-MM-dd HH:mm")</td>
                <td>
                    @if (latest != null)
                    {
                        <span title="@latest.DecisionDate.ToLocalTime()">
                            @latest.Decision by @latest.ApprovedBy (@latest.DecisionDate.ToLocalTime().ToString("yyyy-MM-dd HH:mm"))
                        </span>
                    }
                    else
                    {
                        <span class="text-muted">—</span>
                    }
                </td>
                <td class="col-notes">@claim.Notes</td>

                <td class="col-docs">
                    @if (claim.Documents != null && claim.Documents.Any())
                    {
                        foreach (var d in claim.Documents)
                        {
                            <a class="btn btn-sm btn-outline-primary mb-1 text-truncate"
                               href="@Url.Action("Download", "Files", new { id = d.DocumentId })"
                               title="Download @d.FileName">@d.FileName</a>
                        }
                    }
                    else
                    {
                        <span class="text-muted">None</span>
                    }
                </td>

                <td class="action-cell">
                    <div class="action-grid">
                        <form asp-action="Edit" method="post">
                            <input type="hidden" name="id" value="@claim.ClaimId" />
                            <input type="hidden" name="Decision" value="Approved" />
                            <input type="hidden" name="Comments" value="Approved via list." />
                            <button type="submit" class="btn btn-success btn-sm">Approve</button>
                        </form>

                        <form asp-action="Edit" method="post">
                            <input type="hidden" name="id" value="@claim.ClaimId" />
                            <input type="hidden" name="Decision" value="Rejected" />
                            <input type="hidden" name="Comments" value="Rejected via list." />
                            <button type="submit" class="btn btn-warning btn-sm">Reject</button>
                        </form>

                        <a asp-action="Edit" asp-route-id="@claim.ClaimId" class="btn btn-primary btn-sm">Review</a>

                        <form asp-action="Delete" method="post" onsubmit="return confirm('Delete claim #@claim.ClaimId ?');">
                            <input type="hidden" name="id" value="@claim.ClaimId" />
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </div>
                </td>

            </tr>
        }
    </tbody>
</table>

<a asp-action="Index" class="btn btn-secondary mt-3"><i class="fas fa-arrow-left me-2"></i>Back to Dashboard</a>








